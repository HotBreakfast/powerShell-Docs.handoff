{"nodes":[{"pos":[13,64],"content":"PowerShell Engine Improvements in WMF 5.1 (Preview)","needQuote":true,"nodes":[{"content":"PowerShell Engine Improvements in WMF 5.1 (Preview)","pos":[0,51]}]},{"pos":[97,117],"content":"PowerShell, DSC, WMF","needQuote":true,"nodes":[{"content":"PowerShell, DSC, WMF","pos":[0,20]}]},{"content":"PowerShell engine improvements","pos":[232,262]},{"content":"The following improvements to the core PowerShell engine have been implemented in WMF 5.1:","pos":[264,354]},{"content":"Performance","pos":[360,371]},{"content":"Performance has improved in some important areas:","pos":[376,425]},{"content":"Startup","pos":[429,436]},{"content":"Pipelining to cmdlets like ForEach-Object and Where-Object is approximately 50% faster","pos":[439,525]},{"content":"Some example improvements (your results may vary depending your your hardware):","pos":[528,607]},{"content":"Scenario","pos":[612,620]},{"content":"5.0 Time (ms)","pos":[623,636]},{"content":"5.1 Time (ms)","pos":[639,652]},{"content":"900","pos":[743,746]},{"content":"250","pos":[749,752]},{"pos":[757,783],"content":"First ever PowerShell run:"},{"content":"30000","pos":[826,831]},{"content":"13000","pos":[834,839]},{"pos":[844,873],"content":"Command analysis cache built:"},{"content":"7000","pos":[916,920]},{"content":"520","pos":[923,926]},{"content":"1400","pos":[970,974]},{"content":"750","pos":[977,980]},{"pos":[988,1436],"content":"Note \nOne change related to startup might impact some unsupported scenarios. PowerShell no longer\nreads the files `$pshome\\*.ps1xml` - these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. The files still exist to support V2 side-by-side,\nso if you change the file contents, it will not have any effect to V5, only V2. Note that changing\nthe contents of these files was never a supported scenario.","leadings":["","> ","","","",""],"nodes":[{"content":"Note One change related to startup might impact some unsupported scenarios.","pos":[0,76],"source":"Note \nOne change related to startup might impact some unsupported scenarios."},{"content":"PowerShell no longer reads the files <ph id=\"ph1\">`$pshome\\*.ps1xml`</ph> - these files have been converted to C# to avoid some file and CPU overhead of processing the XML files.","pos":[77,237],"source":" PowerShell no longer\nreads the files `$pshome\\*.ps1xml` - these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files."},{"content":"The files still exist to support V2 side-by-side, so if you change the file contents, it will not have any effect to V5, only V2.","pos":[238,367],"source":" The files still exist to support V2 side-by-side,\nso if you change the file contents, it will not have any effect to V5, only V2."},{"content":"Note that changing the contents of these files was never a supported scenario.","pos":[368,446],"source":" Note that changing\nthe contents of these files was never a supported scenario."}]},{"content":"Another visible change is how PowerShell caches the exported commands and other information for modules that are installed on a system.","pos":[1438,1573],"source":"Another visible change is how PowerShell caches the exported commands and other information for\nmodules that are installed on a system."},{"content":"Previous, this cache was stored in the directory <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`</ph>.","pos":[1574,1688],"source":" Previous, this cache was stored in the directory\n`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`."},{"content":"In WMF 5.1, the cache is a single file <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`</ph>.","pos":[1689,1797],"source":" In WMF 5.1, the cache is a single\nfile `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`."},{"content":"See <bpt id=\"p1\">[</bpt>analysis_cache.md<ept id=\"p1\">]()</ept> for more details.","pos":[1798,1841],"source":"\nSee [analysis_cache.md]() for more details."}],"content":"---\ntitle:   PowerShell Engine Improvements in WMF 5.1 (Preview)\nms.date:  2016-07-13\nkeywords:  PowerShell, DSC, WMF\ndescription:  \nms.topic:  article\nauthor:  keithb\nmanager:  dongill\nms.prod:  powershell\nms.technology: WMF\n---\n\n#PowerShell engine improvements\n\nThe following improvements to the core PowerShell engine have been implemented in WMF 5.1:\n\n\n## Performance ##\n\nPerformance has improved in some important areas:\n\n- Startup\n- Pipelining to cmdlets like ForEach-Object and Where-Object is approximately 50% faster \n\nSome example improvements (your results may vary depending your your hardware): \n\n| Scenario | 5.0 Time (ms) | 5.1 Time (ms) |\n| -------- | :---------------: | :---------------: |\n| `powershell -command \"echo 1\"` | 900 | 250 |\n| First ever PowerShell run: `powershell -command \"Unknown-Command\"` | 30000 | 13000 |\n| Command analysis cache built: `powershell -command \"Unknown-Command\"` | 7000 | 520 |\n| <code>1..1000000 &#124; % { }</code> | 1400 | 750 |\n  \n> Note \n> One change related to startup might impact some unsupported scenarios. PowerShell no longer\nreads the files `$pshome\\*.ps1xml` - these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. The files still exist to support V2 side-by-side,\nso if you change the file contents, it will not have any effect to V5, only V2. Note that changing\nthe contents of these files was never a supported scenario.\n\nAnother visible change is how PowerShell caches the exported commands and other information for\nmodules that are installed on a system. Previous, this cache was stored in the directory\n`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`. In WMF 5.1, the cache is a single\nfile `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`.\nSee [analysis_cache.md]() for more details.\n"}