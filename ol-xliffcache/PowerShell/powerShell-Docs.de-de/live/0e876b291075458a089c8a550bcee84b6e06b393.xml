{"nodes":[{"content":"PowerShell Engine Improvements in WMF 5.1 (Preview)","pos":[13,64]},{"content":"PowerShell engine improvements","pos":[232,262]},{"content":"The following improvements to the core PowerShell engine have been implemented in WMF 5.1:","pos":[264,354]},{"content":"Performance","pos":[360,371]},{"content":"Performance has improved in some important areas:","pos":[376,425]},{"content":"Startup","pos":[429,436]},{"content":"Pipelining to cmdlets like ForEach-Object and Where-Object is approximately 50% faster","pos":[439,525]},{"content":"Some example improvements (your results may vary depending your your hardware):","pos":[528,607]},{"content":"Scenario","pos":[612,620]},{"content":"5.0 Time (ms)","pos":[623,636]},{"content":"5.1 Time (ms)","pos":[639,652]},{"content":"900","pos":[743,746]},{"content":"250","pos":[749,752]},{"pos":[757,783],"content":"First ever PowerShell run:"},{"content":"30000","pos":[826,831]},{"content":"13000","pos":[834,839]},{"pos":[844,873],"content":"Command analysis cache built:"},{"content":"7000","pos":[916,920]},{"content":"520","pos":[923,926]},{"content":"`1..1000000","pos":[931,942]},{"content":"% { }`","pos":[945,951]},{"content":"1400","pos":[954,958]},{"content":"750","pos":[961,964]},{"pos":[972,1424],"content":"[!NOTE]  \nOne change related to startup might impact some unsupported scenarios. PowerShell no longer\nreads the files `$pshome\\*.ps1xml` - these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. The files still exist to support V2 side-by-side,\nso if you change the file contents, it will not have any effect to V5, only V2. Note that changing\nthe contents of these files was never a supported scenario.","leadings":["","> ","","","",""],"nodes":[{"content":"One change related to startup might impact some unsupported scenarios. PowerShell no longer\nreads the files `$pshome\\*.ps1xml` - these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. The files still exist to support V2 side-by-side,\nso if you change the file contents, it will not have any effect to V5, only V2. Note that changing\nthe contents of these files was never a supported scenario.","pos":[10,450],"nodes":[{"content":"One change related to startup might impact some unsupported scenarios.","pos":[0,70]},{"content":"PowerShell no longer reads the files <ph id=\"ph1\">`$pshome\\*.ps1xml`</ph> - these files have been converted to C# to avoid some file and CPU overhead of processing the XML files.","pos":[71,231]},{"content":"The files still exist to support V2 side-by-side, so if you change the file contents, it will not have any effect to V5, only V2.","pos":[232,361]},{"content":"Note that changing the contents of these files was never a supported scenario.","pos":[362,440]}]}]},{"content":"Another visible change is how PowerShell caches the exported commands and other information for modules that are installed on a system.","pos":[1426,1561]},{"content":"Previous, this cache was stored in the directory <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`</ph>.","pos":[1562,1676]},{"content":"In WMF 5.1, the cache is a single file <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`</ph>.","pos":[1677,1785]},{"content":"See <bpt id=\"p1\">[</bpt>analysis_cache.md<ept id=\"p1\">]()</ept> for more details.","pos":[1786,1829]}],"content":"---\ntitle:   PowerShell Engine Improvements in WMF 5.1 (Preview)\nms.date:  2016-07-13\nkeywords:  PowerShell, DSC, WMF\ndescription:  \nms.topic:  article\nauthor:  keithb\nmanager:  dongill\nms.prod:  powershell\nms.technology: WMF\n---\n\n#PowerShell engine improvements\n\nThe following improvements to the core PowerShell engine have been implemented in WMF 5.1:\n\n\n## Performance ##\n\nPerformance has improved in some important areas:\n\n- Startup\n- Pipelining to cmdlets like ForEach-Object and Where-Object is approximately 50% faster \n\nSome example improvements (your results may vary depending your your hardware): \n\n| Scenario | 5.0 Time (ms) | 5.1 Time (ms) |\n| -------- | :---------------: | :---------------: |\n| `powershell -command \"echo 1\"` | 900 | 250 |\n| First ever PowerShell run: `powershell -command \"Unknown-Command\"` | 30000 | 13000 |\n| Command analysis cache built: `powershell -command \"Unknown-Command\"` | 7000 | 520 |\n| `1..1000000 | % { }` | 1400 | 750 |\n  \n> [!NOTE]  \n> One change related to startup might impact some unsupported scenarios. PowerShell no longer\nreads the files `$pshome\\*.ps1xml` - these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. The files still exist to support V2 side-by-side,\nso if you change the file contents, it will not have any effect to V5, only V2. Note that changing\nthe contents of these files was never a supported scenario.\n\nAnother visible change is how PowerShell caches the exported commands and other information for\nmodules that are installed on a system. Previous, this cache was stored in the directory\n`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`. In WMF 5.1, the cache is a single\nfile `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`.\nSee [analysis_cache.md]() for more details."}