{"nodes":[{"content":"Bug Fixes in WMF 5.1 (Preview)","pos":[13,43]},{"content":"Bug Fixes in WMF 5.1 (Preview)","pos":[212,242]},{"content":"Bug fixes","pos":[248,257]},{"content":"The following notable bugs are fixed in WMF 5.1:","pos":[262,310]},{"pos":[316,350],"content":"Module auto-discovery fully honors"},{"content":"Module auto-discovery (loading modules automatically without an explicit Import-Module when calling a command) was introduced in WMF 3.","pos":[376,511]},{"content":"When introduced, PowerShell checked for commands in <ph id=\"ph1\">`$PSHome\\Modules`</ph> before using <ph id=\"ph2\">`$env:PSModulePath`</ph>.","pos":[512,615]},{"content":"WMF 5.1 changes this behavior to honor <ph id=\"ph1\">`$env:PSModulePath`</ph> completely.","pos":[617,687]},{"content":"This allows for a user-authored module that defines commands provided by PowerShell (e.g. <ph id=\"ph1\">`Get-ChildItem`</ph>) to be auto-loaded and correctly overriding the built-in command.","pos":[688,860]},{"pos":[866,903],"content":"File redirection no longer hard-codes"},{"pos":[929,1131],"content":"In all previous versions of PowerShell, it was impossible to control the file encoding used by the file redirection operator, e.g. <ph id=\"ph1\">`get-childitem &gt; out.txt`</ph> because PowerShell added <ph id=\"ph2\">`-Encoding Unicode`</ph>."},{"pos":[1133,1252],"content":"Starting with WMF 5.1, you can now change the file encoding of redirection by setting <ph id=\"ph1\">`$PSDefaultParameterValues`</ph>, e.g."},{"pos":[1324,1366],"content":"Fixed a regression in accessing members of"},{"content":"A regression introduced in WMF 5.0 broke accessing members of <ph id=\"ph1\">`System.Reflection.RuntimeType`</ph>, e.g. <ph id=\"ph2\">`[int].ImplementedInterfaces`</ph>.","pos":[1401,1531]},{"content":"This bug has been fixed in WMF5.1.","pos":[1532,1566]},{"content":"Fixed some issues with COM objects","pos":[1573,1607]},{"content":"WMF 5.0 introduced a new COM binder for invoking methods on COM objects and accessing properties of COM objects.","pos":[1613,1725]},{"content":"This new binder improved performance significantly but also introduced some bugs which have been fixed in WMF5.1.","pos":[1726,1839]},{"content":"Argument conversions were not always performed correctly","pos":[1846,1902]},{"content":"In the following example:","pos":[1909,1934]},{"pos":[2007,2305],"content":"The SendKeys method expects a string, but PowerShell did not convert the char to a string, deferring the conversion to IDispatch::Invoke, which uses VariantChangeType to do the conversion, which in this example resulted in sending the keys '1', '7', and '3' instead of the expected Volume.Mute key."},{"content":"Enumerable COM objects not always handled correctly","pos":[2312,2363]},{"content":"PowerShell normally enumerates most enumerable objects, but a regression introduced in WMF 5.0 prevented the enumeration of COM objects that implement IEnumerable.","pos":[2370,2533]},{"content":"For example:","pos":[2535,2547]},{"pos":[2717,2849],"content":"In the above example, WMF 5.0 incorrectly wrote the Scripting.Dictionary to the pipeline instead of enumerating the key value pairs."},{"pos":[2851,2972],"content":"This change also addresses <bpt id=\"p1\">[</bpt>issues 1752224 on Connect<ept id=\"p1\">](https://connect.microsoft.com/PowerShell/feedback/details/1752224)</ept>"},{"pos":[2990,3020],"content":"was not allowed inside classes"},{"content":"WMF5 introduced classes with validation of type literals used in classes.","pos":[3026,3099]},{"content":"looks like a type literal but is not a true .Net type.","pos":[3113,3167]},{"content":"WMF5 incorrectly reported an error on <ph id=\"ph1\">`[ordered]`</ph> inside a class:","pos":[3169,3234]},{"content":"Help on About topics with multiple versions does not work","pos":[3333,3390]},{"pos":[3396,3623],"content":"Before WMF 5.1, if you had multiple versions of a module installed and they all shared a help topic, for example, about_PSReadline, <ph id=\"ph1\">`help about_PSReadline`</ph> would return multiple topics with no obvious way to view the real help."},{"content":"WMF 5.1 fixes this by returning the help for the latest version of the topic.","pos":[3625,3702]},{"content":"Get-Help does not provide a way to specify which version you want help for.","pos":[3704,3779]},{"content":"To work around this, navigate to the modules directory and view the help directly with a tool like your favorite editor.","pos":[3780,3900]}],"content":"---\ntitle:   Bug Fixes in WMF 5.1 (Preview)\nms.date:  2016-07-13\nkeywords:  PowerShell, DSC, WMF\ndescription:  \nms.topic:  article\nauthor:  keithb\nmanager:  dongill\nms.prod:  powershell\nms.technology: WMF\n---\n\n# Bug Fixes in WMF 5.1 (Preview)#\n\n## Bug fixes ##\n\nThe following notable bugs are fixed in WMF 5.1:\n\n### Module auto-discovery fully honors `$env:PSModulePath` ###\n\nModule auto-discovery (loading modules automatically without an explicit Import-Module when calling a command)\nwas introduced in WMF 3. When introduced, PowerShell checked for commands in `$PSHome\\Modules` before\nusing `$env:PSModulePath`.\n\nWMF 5.1 changes this behavior to honor `$env:PSModulePath` completely. This allows for a user-authored module \nthat defines commands provided by PowerShell (e.g. `Get-ChildItem`) to be auto-loaded and correctly overriding\nthe built-in command.\n\n### File redirection no longer hard-codes `-Encoding Unicode` ###\n\nIn all previous versions of PowerShell, it was impossible to control the file encoding used by the file\nredirection operator, e.g. `get-childitem > out.txt` because PowerShell added `-Encoding Unicode`.\n\nStarting with WMF 5.1, you can now change the file encoding of redirection by setting `$PSDefaultParameterValues`, e.g.\n\n```\n$PSDefaultParameterValues[\"Out-File:Encoding\"] = \"Ascii\"\n```\n\n### Fixed a regression in accessing members of `System.Reflection.TypeInfo` ###\n\nA regression introduced in WMF 5.0 broke accessing members of `System.Reflection.RuntimeType`, e.g. `[int].ImplementedInterfaces`.\nThis bug has been fixed in WMF5.1.\n\n\n### Fixed some issues with COM objects ###\n\nWMF 5.0 introduced a new COM binder for invoking methods on COM objects and accessing properties of COM objects.\nThis new binder improved performance significantly but also introduced some bugs which have been fixed in WMF5.1.\n\n#### Argument conversions were not always performed correctly ####\n\nIn the following example:\n\n```\n$obj = new-object -com wscript.shell\n$obj.SendKeys([char]173)\n```\n\nThe SendKeys method expects a string, but PowerShell did not convert the char to a string, deferring the conversion\nto IDispatch::Invoke, which uses VariantChangeType to do the conversion, which in this example resulted in sending\nthe keys '1', '7', and '3' instead of the expected Volume.Mute key.\n\n#### Enumerable COM objects not always handled correctly ####\n\nPowerShell normally enumerates most enumerable objects, but a regression introduced in WMF 5.0 prevented the enumeration\nof COM objects that implement IEnumerable.  For example:\n\n```\nfunction Get-COMDictionary\n{\n    $d = New-Object -ComObject Scripting.Dictionary\n    $d.Add('a', 2)\n    $d.Add('b', 2)\n    return $d\n}\n\n$x = Get-COMDictionary\n```\n\nIn the above example, WMF 5.0 incorrectly wrote the Scripting.Dictionary to the pipeline\ninstead of enumerating the key value pairs.\n\nThis change also addresses [issues 1752224 on Connect](https://connect.microsoft.com/PowerShell/feedback/details/1752224)\n\n### `[ordered]` was not allowed inside classes ###\n\nWMF5 introduced classes with validation of type literals used in classes.  `[ordered]` looks like a type\nliteral but is not a true .Net type.  WMF5 incorrectly reported an error on `[ordered]` inside a class:\n\n```\nclass CThing\n{\n    [object] foo($i)\n    {\n        [ordered]@{ Thing = $i }\n    }\n}\n```\n\n\n### Help on About topics with multiple versions does not work ###\n\nBefore WMF 5.1, if you had multiple versions of a module installed and they all shared a help topic,\nfor example, about_PSReadline, `help about_PSReadline` would return multiple topics with no obvious way\nto view the real help.\n\nWMF 5.1 fixes this by returning the help for the latest version of the topic.\n\nGet-Help does not provide a way to specify which version you want help for. To work around this,\nnavigate to the modules directory and view the help directly with a tool like your favorite editor. \n"}