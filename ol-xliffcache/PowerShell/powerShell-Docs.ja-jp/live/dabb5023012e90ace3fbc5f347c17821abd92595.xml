{"nodes":[{"content":"remake the demo endpoint","pos":[156,180]},{"content":"Remake the Demo Endpoint","pos":[215,239]},{"content":"In this section, you will learn how to generate an exact replica of the demo endpoint you used in the above section.","pos":[240,356]},{"content":"This will introduce core concepts that are necessary to understand JEA, including PowerShell Session Configurations and Role Capabilities.","pos":[357,495]},{"content":"PowerShell Session Configurations","pos":[500,533]},{"content":"When you used JEA in the above section, you started by running the following command:","pos":[534,619]},{"content":"While most of the parameters are self-explanatory, the <bpt id=\"p1\">*</bpt>ConfigurationName<ept id=\"p1\">*</ept> parameter may seem confusing at first.","pos":[726,839]},{"content":"That parameter specified the PowerShell Session Configuration to which you were connecting.","pos":[840,931]},{"content":"<bpt id=\"p1\">*</bpt>PowerShell Session Configuration<ept id=\"p1\">*</ept> is a fancy term for a PowerShell endpoint.","pos":[933,1010]},{"content":"It is the figurative \"place\" where users connect and get access to PowerShell functionality.","pos":[1011,1103]},{"content":"Based on how you set up a Session Configuration, it can provide different functionality to connecting users.","pos":[1104,1212]},{"content":"For JEA, we use Session Configurations to restrict PowerShell to a limited set of functionality and to run as a privileged virtual account.","pos":[1213,1352]},{"content":"You already have several registered PowerShell Session Configurations on your machine, each set up slightly differently.","pos":[1354,1474]},{"content":"Most of them come with Windows, but the \"JEA_Demo\" Session Configuration was set up in the <bpt id=\"p1\">[</bpt>prerequisites<ept id=\"p1\">](prerequisites.md)</ept> section.","pos":[1475,1608]},{"content":"You can see all registered Session Configurations by running the following command in an Administrator PowerShell prompt:","pos":[1609,1730]},{"content":"PowerShell Session Configuration Files","pos":[1781,1819]},{"content":"You can make new Session Configurations by registering new <bpt id=\"p1\">*</bpt>PowerShell Session Configuration Files<ept id=\"p1\">*</ept>.","pos":[1820,1920]},{"content":"Session Configuration Files have \".pssc\" file extensions.","pos":[1921,1978]},{"content":"You can generate Session Configuration Files with the New-PSSessionConfigurationFile cmdlet.","pos":[1979,2071]},{"content":"Next, you are going to create and register a new Session Configuration for JEA.","pos":[2073,2152]},{"content":"Generate and Modify your PowerShell Session Configuration","pos":[2157,2214]},{"content":"Run the following command to generate a PowerShell Session Configuration \"skeleton\" file.","pos":[2215,2304]},{"pos":[2414,2598],"content":"**TIP:** Only the most common configuration settings are included in the skeleton file by default.\nUse the `-Full` parameter to include all applicable settings in the generated PSSC.","leadings":["","> "],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>TIP:<ept id=\"p1\">**</ept> Only the most common configuration settings are included in the skeleton file by default.","pos":[0,98]},{"content":"Use the <ph id=\"ph1\">`-Full`</ph> parameter to include all applicable settings in the generated PSSC.","pos":[99,182]}]},{"content":"Open the file in PowerShell ISE, or your favorite text editor.","pos":[2600,2662]},{"content":"Update the following fields in the file with the values below (remember to substitue in your own non-administrator security group):","pos":[2737,2868]},{"content":"Here is what each of those entries mean:","pos":[3396,3436]},{"content":"The <bpt id=\"p1\">*</bpt>SessionType<ept id=\"p1\">*</ept> field defines preset default settings to use with this endpoint.","pos":[3442,3524]},{"content":"<bpt id=\"p1\">*</bpt>RestrictedRemoteServer<ept id=\"p1\">*</ept> defines the minimal settings necessary for remote management.","pos":[3525,3611]},{"content":"By default, a <bpt id=\"p1\">*</bpt>RestrictedRemoteServer<ept id=\"p1\">*</ept> endpoint will expose Get-Command, Get-FormatData, Select-Object, Get-Help, Measure-Object, Exit-PSSession, Clear-Host, and Out-Default.","pos":[3612,3786]},{"content":"It will set the <bpt id=\"p1\">*</bpt>ExecutionPolicy<ept id=\"p1\">*</ept> to <bpt id=\"p2\">*</bpt>RemoteSigned<ept id=\"p2\">*</ept>, and the <bpt id=\"p3\">*</bpt>LanguageMode<ept id=\"p3\">*</ept> to <bpt id=\"p4\">*</bpt>NoLanguage<ept id=\"p4\">*</ept>.","pos":[3787,3879]},{"content":"The net effect of these settings is a secure and minimal starting point for configuring your endpoint.","pos":[3880,3982]},{"content":"The <bpt id=\"p1\">*</bpt>RoleDefinitions<ept id=\"p1\">*</ept> field assigns Role Capabilities to specific groups.","pos":[3988,4061]},{"content":"It defines who can do what as a privileged account.","pos":[4062,4113]},{"content":"With this field, you can specify the functionality available to any connecting user based on group membership.","pos":[4114,4224]},{"content":"This is the core of JEA's RBAC functionality.","pos":[4225,4270]},{"content":"In this example, you are exposing the pre-made \"Demo\" RoleCapability to members of the \"Contoso\\JEA_NonAdmin_Operator\" group.","pos":[4271,4396]},{"content":"The <bpt id=\"p1\">*</bpt>RunAsVirtualAccount<ept id=\"p1\">*</ept> field indicates that PowerShell should \"run as\" a Virtual Account at this endpoint.","pos":[4402,4511]},{"content":"By default, the Virtual Account is a member of the built in Administrators group.","pos":[4512,4593]},{"content":"On a domain controller, it is also a member of the Domain Administrators group by default.","pos":[4594,4684]},{"content":"Later in this guide, you will learn how to customize the privileges of the Virtual Account.","pos":[4685,4776]},{"content":"The <bpt id=\"p1\">*</bpt>TranscriptDirectory<ept id=\"p1\">*</ept> field defines where \"over-the-shoulder\" PowerShell transcripts are saved after each remote session.","pos":[4782,4907]},{"content":"These transcripts allow you to inspect the actions taken in each session in a readable way.","pos":[4908,4999]},{"content":"For more information about PowerShell transcripts, check out this <bpt id=\"p1\">[</bpt>blog post<ept id=\"p1\">](http://blogs.msdn.com/b/powershell/archive/2015/06/09/powershell-the-blue-team.aspx)</ept>.","pos":[5000,5163]},{"content":"Note: regular Windows Eventing also captures information about what each user ran with PowerShell.","pos":[5164,5262]},{"content":"Transcripts are just a bit more readable.","pos":[5263,5304]},{"pos":[5306,5352],"content":"Finally, save your changes to <bpt id=\"p1\">*</bpt>JEADemo2.pssc<ept id=\"p1\">*</ept>."},{"content":"Apply the PowerShell Session Configuration","pos":[5357,5399]},{"content":"To create an endpoint from a Session Configuration file, you need to register the file.","pos":[5401,5488]},{"content":"This requires a few pieces of information:","pos":[5489,5531]},{"content":"The path to the Session Configuration file.","pos":[5536,5579]},{"content":"The name of your registered Session Configuration.","pos":[5583,5633]},{"content":"This is the same name users provide to the \"ConfigurationName\" parameter when they connect to your endpoint with <ph id=\"ph1\">`Enter-PSSession`</ph> or <ph id=\"ph2\">`New-PSSession`</ph>.","pos":[5634,5784]},{"content":"To register the Session Configuration on your local machine, run the following command:","pos":[5786,5873]},{"content":"Congratulations!","pos":[5999,6015]},{"content":"You have set up your JEA endpoint.","pos":[6016,6050]},{"content":"Test Out Your Endpoint","pos":[6055,6077]},{"content":"Re-run the steps listed in the <bpt id=\"p1\">[</bpt>Using JEA<ept id=\"p1\">](using-jea.md)</ept> section against your new endpoint to confirm it is operating as intended.","pos":[6078,6208]},{"content":"Be sure to use the new endpoint name (JEADemo2) when providing the configuration name to Enter-PSSession.","pos":[6209,6314]},{"content":"Key Concepts","pos":[6424,6436]},{"content":"<bpt id=\"p1\">**</bpt>PowerShell Session Configuration<ept id=\"p1\">**</ept>: Sometimes referred to as <bpt id=\"p2\">*</bpt>PowerShell Endpoint<ept id=\"p2\">*</ept>, this is the figurative \"place\" where users connect and get access to PowerShell functionality.","pos":[6437,6617]},{"content":"You can list the registered Session Configurations on your system by running <ph id=\"ph1\">`Get-PSSessionConfiguration`</ph>.","pos":[6618,6724]},{"content":"When configured in a specific way, a PowerShell Session Configuration can be called a <bpt id=\"p1\">*</bpt>JEA Endpoint<ept id=\"p1\">*</ept>.","pos":[6725,6826]},{"content":"<bpt id=\"p1\">**</bpt>PowerShell Session Configuration File (.pssc)<ept id=\"p1\">**</ept>: A file that, when registered, defines settings for a PowerShell Session Configuration.","pos":[6828,6965]},{"content":"It contains specifications for user roles that can connect to the endpoint, the \"run as\" Virtual Account, and more.","pos":[6966,7081]},{"content":"<bpt id=\"p1\">**</bpt>Role Definitions<ept id=\"p1\">**</ept>: The field in a Session Configuration File that defines the Role Capabilities granted to connecting users.","pos":[7088,7215]},{"content":"It defines <bpt id=\"p1\">*</bpt>who<ept id=\"p1\">*</ept> can do <bpt id=\"p2\">*</bpt>what<ept id=\"p2\">*</ept> as a privileged account.","pos":[7216,7271]},{"content":"This is the core of JEA's RBAC capabilities.","pos":[7272,7316]},{"content":"<bpt id=\"p1\">**</bpt>SessionType<ept id=\"p1\">**</ept>: A field in a Session Configuration File that represents default settings for a Session Configuration.","pos":[7318,7436]},{"content":"For JEA endpoints, this must be set to RestrictedRemoteServer.","pos":[7437,7499]},{"content":"<bpt id=\"p1\">**</bpt>PowerShell Transcript<ept id=\"p1\">**</ept>: A file containing an \"over-the-shoulder\" view of a PowerShell session.","pos":[7501,7598]},{"content":"You can set PowerShell to generate transcripts for JEA sessions using the TranscriptDirectory field.","pos":[7599,7699]},{"content":"For more information on transcripts, check out this <bpt id=\"p1\">[</bpt>blog post<ept id=\"p1\">](https://technet.microsoft.com/en-us/magazine/ff687007.aspx)</ept>.","pos":[7700,7824]}],"content":"---\ndescription:  \nmanager:  dongill\nms.topic:  article\nauthor:  jpjofre\nms.prod:  powershell\nkeywords:  powershell,cmdlet,jea\nms.date:  2016-06-22\ntitle:  remake the demo endpoint\nms.technology:  powershell\n---\n\n# Remake the Demo Endpoint\nIn this section, you will learn how to generate an exact replica of the demo endpoint you used in the above section.\nThis will introduce core concepts that are necessary to understand JEA, including PowerShell Session Configurations and Role Capabilities.\n\n## PowerShell Session Configurations\nWhen you used JEA in the above section, you started by running the following command:\n\n```PowerShell\nEnter-PSSession -ComputerName . -ConfigurationName JEA_Demo -Credential $NonAdminCred\n```\n\nWhile most of the parameters are self-explanatory, the *ConfigurationName* parameter may seem confusing at first.\nThat parameter specified the PowerShell Session Configuration to which you were connecting.\n\n*PowerShell Session Configuration* is a fancy term for a PowerShell endpoint.\nIt is the figurative \"place\" where users connect and get access to PowerShell functionality.\nBased on how you set up a Session Configuration, it can provide different functionality to connecting users.\nFor JEA, we use Session Configurations to restrict PowerShell to a limited set of functionality and to run as a privileged virtual account.\n\nYou already have several registered PowerShell Session Configurations on your machine, each set up slightly differently.\nMost of them come with Windows, but the \"JEA_Demo\" Session Configuration was set up in the [prerequisites](prerequisites.md) section.\nYou can see all registered Session Configurations by running the following command in an Administrator PowerShell prompt:\n\n```PowerShell\nGet-PSSessionConfiguration\n```\n\n## PowerShell Session Configuration Files\nYou can make new Session Configurations by registering new *PowerShell Session Configuration Files*.\nSession Configuration Files have \".pssc\" file extensions.\nYou can generate Session Configuration Files with the New-PSSessionConfigurationFile cmdlet.\n\nNext, you are going to create and register a new Session Configuration for JEA.\n\n## Generate and Modify your PowerShell Session Configuration\nRun the following command to generate a PowerShell Session Configuration \"skeleton\" file.\n\n```PowerShell\nNew-PSSessionConfigurationFile -Path \"$env:ProgramData\\JEAConfiguration\\JEADemo2.pssc\"\n```\n\n> **TIP:** Only the most common configuration settings are included in the skeleton file by default.\n> Use the `-Full` parameter to include all applicable settings in the generated PSSC.\n\nOpen the file in PowerShell ISE, or your favorite text editor.\n\n```PowerShell\nise \"$env:ProgramData\\JEAConfiguration\\JEADemo2.pssc\"\n```\n\nUpdate the following fields in the file with the values below (remember to substitue in your own non-administrator security group):\n\n```PowerShell\n# OLD: SessionType = 'Default'\nSessionType = 'RestrictedRemoteServer'\n\n# OLD: TranscriptDirectory = 'C:\\Transcripts\\'\nTranscriptDirectory = \"C:\\ProgramData\\JEAConfiguration\\Transcripts\"\n\n# OLD: # RunAsVirtualAccount = $true\nRunAsVirtualAccount = $true\n\n# OLD: RoleDefinitions = @{ 'CONTOSO\\SqlAdmins' = @{ RoleCapabilities = 'SqlAdministration' }; 'CONTOSO\\ServerMonitors' = @{ VisibleCmdlets = 'Get-Process' } }\nRoleDefinitions = @{'CONTOSO\\JEA_NonAdmin_Operator' = @{ RoleCapabilities =  'Maintenance' }}\n```\n\nHere is what each of those entries mean:\n\n1.  The *SessionType* field defines preset default settings to use with this endpoint.\n*RestrictedRemoteServer* defines the minimal settings necessary for remote management.\nBy default, a *RestrictedRemoteServer* endpoint will expose Get-Command, Get-FormatData, Select-Object, Get-Help, Measure-Object, Exit-PSSession, Clear-Host, and Out-Default.\nIt will set the *ExecutionPolicy* to *RemoteSigned*, and the *LanguageMode* to *NoLanguage*.\nThe net effect of these settings is a secure and minimal starting point for configuring your endpoint.\n\n2.  The *RoleDefinitions* field assigns Role Capabilities to specific groups.\nIt defines who can do what as a privileged account.\nWith this field, you can specify the functionality available to any connecting user based on group membership.\nThis is the core of JEA's RBAC functionality.\nIn this example, you are exposing the pre-made \"Demo\" RoleCapability to members of the \"Contoso\\JEA_NonAdmin_Operator\" group.\n\n3.  The *RunAsVirtualAccount* field indicates that PowerShell should \"run as\" a Virtual Account at this endpoint.\nBy default, the Virtual Account is a member of the built in Administrators group.\nOn a domain controller, it is also a member of the Domain Administrators group by default.\nLater in this guide, you will learn how to customize the privileges of the Virtual Account.\n\n4.  The *TranscriptDirectory* field defines where \"over-the-shoulder\" PowerShell transcripts are saved after each remote session.\nThese transcripts allow you to inspect the actions taken in each session in a readable way.\nFor more information about PowerShell transcripts, check out this [blog post](http://blogs.msdn.com/b/powershell/archive/2015/06/09/powershell-the-blue-team.aspx).\nNote: regular Windows Eventing also captures information about what each user ran with PowerShell.\nTranscripts are just a bit more readable.\n\nFinally, save your changes to *JEADemo2.pssc*.\n\n## Apply the PowerShell Session Configuration\n\nTo create an endpoint from a Session Configuration file, you need to register the file.\nThis requires a few pieces of information:\n\n1. The path to the Session Configuration file.\n2. The name of your registered Session Configuration. This is the same name users provide to the \"ConfigurationName\" parameter when they connect to your endpoint with `Enter-PSSession` or `New-PSSession`.\n\nTo register the Session Configuration on your local machine, run the following command:\n\n```PowerShell\nRegister-PSSessionConfiguration -Name 'JEADemo2' -Path \"$env:ProgramData\\JEAConfiguration\\JEADemo2.pssc\"\n```\n\nCongratulations! You have set up your JEA endpoint.\n\n## Test Out Your Endpoint\nRe-run the steps listed in the [Using JEA](using-jea.md) section against your new endpoint to confirm it is operating as intended.\nBe sure to use the new endpoint name (JEADemo2) when providing the configuration name to Enter-PSSession.\n\n```PowerShell\nEnter-PSSession -ComputerName . -ConfigurationName JEADemo2 -Credential $NonAdminCred\n```\n\n## Key Concepts\n**PowerShell Session Configuration**:\nSometimes referred to as *PowerShell Endpoint*, this is the figurative \"place\" where users connect and get access to PowerShell functionality.\nYou can list the registered Session Configurations on your system by running `Get-PSSessionConfiguration`.\nWhen configured in a specific way, a PowerShell Session Configuration can be called a *JEA Endpoint*.\n\n**PowerShell Session Configuration File (.pssc)**:\nA file that, when registered, defines settings for a PowerShell Session Configuration.\nIt contains specifications for user roles that can connect to the endpoint, the \"run as\" Virtual Account, and more.     \n\n**Role Definitions**:\nThe field in a Session Configuration File that defines the Role Capabilities granted to connecting users.\nIt defines *who* can do *what* as a privileged account.\nThis is the core of JEA's RBAC capabilities.\n\n**SessionType**:\nA field in a Session Configuration File that represents default settings for a Session Configuration.\nFor JEA endpoints, this must be set to RestrictedRemoteServer.\n\n**PowerShell Transcript**:\nA file containing an \"over-the-shoulder\" view of a PowerShell session.\nYou can set PowerShell to generate transcripts for JEA sessions using the TranscriptDirectory field.\nFor more information on transcripts, check out this [blog post](https://technet.microsoft.com/en-us/magazine/ff687007.aspx).\n\n"}