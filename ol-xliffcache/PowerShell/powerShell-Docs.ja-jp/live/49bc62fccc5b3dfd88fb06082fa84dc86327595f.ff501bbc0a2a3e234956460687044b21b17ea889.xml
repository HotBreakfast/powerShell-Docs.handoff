{"nodes":[{"pos":[13,60],"content":"New Scenarios and Features in WMF 5.1 (Preview)","needQuote":true,"nodes":[{"content":"New Scenarios and Features in WMF 5.1 (Preview)","pos":[0,47]}]},{"pos":[93,113],"content":"PowerShell, DSC, WMF","needQuote":true,"nodes":[{"content":"PowerShell, DSC, WMF","pos":[0,20]}]},{"content":"New Scenarios and Features in WMF 5.1 (Preview)","pos":[229,276]},{"content":"Note: This information is preliminary and subject to change.","pos":[282,342]},{"content":"PowerShell Editions","pos":[347,366]},{"content":"Starting with version 5.1, PowerShell is available in different editions which denote varying feature sets and platform compatibility.","pos":[370,504]},{"pos":[508,724],"content":"<bpt id=\"p1\">**</bpt>Desktop Edition:<ept id=\"p1\">**</ept> Built on .NET Framework and provides compatibility with scripts and modules targeting versions of PowerShell running on full footprint editions of Windows such as Server Core and Windows Desktop."},{"pos":[727,934],"content":"<bpt id=\"p1\">**</bpt>Core Edition:<ept id=\"p1\">**</ept> Built on .NET Core and provides compatibility with scripts and modules targeting versions of PowerShell running on reduced footprint editions of Windows such as Nano Server and Windows IoT."},{"content":"Learn more about using PowerShell Editions","pos":[938,980]},{"content":"Determine running edition of PowerShell","pos":[986,1025]},{"content":"Declare a module's compatibility to specific PowerShell versions","pos":[1032,1096]},{"content":"Filter Get-Module results by CompatiblePSEditions","pos":[1103,1152]},{"content":"Prevent script execution unless run on a comaptible edition of PowerShell","pos":[1159,1232]},{"content":"Catalog Cmdlets","pos":[1240,1255]},{"pos":[1259,1446],"content":"Two new cmdlets have been added in the <bpt id=\"p1\">[</bpt>Microsoft.Powershell.Secuity<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/hh847877.aspx)</ept> module; these generate and validate windows catalog files."},{"content":"New-FileCatalog","pos":[1453,1468]},{"content":"New File catalog creates a Windows catalog file for set of folders and files.","pos":[1504,1581]},{"content":"This catalog file contains hashes for all files in specified paths.","pos":[1582,1649]},{"content":"Users can distribute the set of folders along with corresponding catalog file representing those folders.","pos":[1650,1755]},{"content":"This information is useful to validate whether any changes have been made to the folders since catalog creation time.","pos":[1756,1873]},{"content":"Catalog versions 1 and 2 are supported.","pos":[2028,2067]},{"content":"Version 1 uses the SHA1 hashing algorithm to create file hashes; version 2 uses SHA256.","pos":[2068,2155]},{"content":"Catalog version 2 is not supported on <bpt id=\"p1\">*</bpt>Windows Server 2008 R2<ept id=\"p1\">*</ept> or <bpt id=\"p2\">*</bpt>Windows 7<ept id=\"p2\">*</ept>.","pos":[2156,2234]},{"content":"You should use catalog version 2 on <bpt id=\"p1\">*</bpt>Windows 8<ept id=\"p1\">*</ept>, <bpt id=\"p2\">*</bpt>Windows Server 2012<ept id=\"p2\">*</ept>, and later operating systems.","pos":[2235,2335]},{"content":"This creates the catalog file.","pos":[2374,2404]},{"pos":[2476,2649],"content":"To verify the integrity of catalog file (Pester.cat in above exmaple), sign it using <bpt id=\"p1\">[</bpt>Set-AuthenticodeSignature<ept id=\"p1\">](https://technet.microsoft.com/library/hh849819.aspx)</ept> cmdlet."},{"content":"Test-FileCatalog","pos":[2658,2674]},{"content":"Test File catalog validates the catalog representing a set of folders.","pos":[2710,2780]},{"content":"This cmdlet compares all the files hashes and their relative paths found in <bpt id=\"p1\">*</bpt>catalog<ept id=\"p1\">*</ept> with ones on <bpt id=\"p2\">*</bpt>disk<ept id=\"p2\">*</ept>.","pos":[2984,3090]},{"content":"If it detects any mismatch between file hashes and paths it returns the status as <bpt id=\"p1\">*</bpt>ValidationFailed<ept id=\"p1\">*</ept>.","pos":[3091,3192]},{"content":"Users can retrieve all this information by using the <bpt id=\"p1\">*</bpt>-Detailed<ept id=\"p1\">*</ept> flag.","pos":[3193,3263]},{"content":"It also displays signing status of catalog in <bpt id=\"p1\">*</bpt>Signature<ept id=\"p1\">*</ept> filed which is equivalent to calling <bpt id=\"p2\">[</bpt>Get-AuthenticodeSignature<ept id=\"p2\">](https://technet.microsoft.com/en-us/library/hh849805.aspx)</ept> cmdlet on the catalog file.","pos":[3264,3473]},{"content":"Users can also skip any file during validation by using the <bpt id=\"p1\">*</bpt>-FilesToSkip<ept id=\"p1\">*</ept> parameter.","pos":[3474,3560]},{"content":"Module Analysis Cache","pos":[3567,3588]},{"pos":[3592,3732],"content":"Starting with WMF 5.1, PowerShell provides control over the file that is used to cache data about a module, such as the commands it exports."},{"content":"By default, this cache is stored in the file <ph id=\"ph1\">`${env:LOCALAPPDATA}\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`</ph>.","pos":[3734,3850]},{"content":"The cache is typically read at startup while searching for a command and is written on a background thread sometime after a module is imported.","pos":[3851,3994]},{"content":"To change the default location of the cache, set the environment variable PSModuleAnalysisCachePath before starting PowerShell.","pos":[3996,4123]},{"content":"Changes to this environment variable will only affect children processes.","pos":[4124,4197]},{"content":"The value should name a full path (including filename) that PowerShell has permission to create and write files.","pos":[4198,4310]},{"content":"To disable the file cache, set this value to an invalid location, for example:","pos":[4311,4389]},{"content":"This sets the path to an invalid device.","pos":[4449,4489]},{"content":"Iff PowerShell can't write to the path, no error is returned, but you can see error reporting via a tracer:","pos":[4490,4597]},{"content":"When writing out the cache, PowerShell will check for modules that no longer exist to avoid an unnecessarily large cache.","pos":[4723,4844]},{"content":"Sometimes these checks are not desirable, in which case you can turn them off by setting","pos":[4845,4933]},{"content":"Setting this environment variable will take effect immediately in the current process.","pos":[4999,5085]},{"content":"Specifying module version","pos":[5089,5114]},{"content":"In WMF 5.1, <ph id=\"ph1\">`using module`</ph> behaves the same way as other module-related constructions in PowerShell.","pos":[5116,5216]},{"content":"Previously, you had no way to specify a particular module version; if there were multiple versions present, this resulted in an error.","pos":[5217,5351]},{"content":"In WMF 5.1:","pos":[5354,5365]},{"content":"You can use <ph id=\"ph1\">`ModuleSpecification`</ph> <bpt id=\"p1\">[</bpt>hashtable<ept id=\"p1\">](https://msdn.microsoft.com/en-us/library/jj136290(v=vs.85).aspx)</ept>.","pos":[5369,5480]},{"content":"This hashtable has the same format as <ph id=\"ph1\">`Get-Module -FullyQualifiedName`</ph>.","pos":[5481,5553]},{"pos":[5557,5565],"content":"Example:"},{"pos":[5640,5842],"content":"If there are multiple versions of the module, PowerShell uses the <bpt id=\"p1\">**</bpt>same resolution logic<ept id=\"p1\">**</ept> as <ph id=\"ph1\">`Import-Module`</ph> and doesn't return an error--the same behavior as <ph id=\"ph2\">`Import-Module`</ph> and <ph id=\"ph3\">`Import-DscResource`</ph>."},{"content":"Improvements to Pester","pos":[5853,5875]},{"content":"In WMF 5.1, the version of Pester that ships with PowerShell has been updated from 3.3.5 to 3.4.0, with the addition of commit https://github.com/pester/Pester/pull/484/commits/3854ae8a1f215b39697ac6c2607baf42257b102e, which enables better behavior for Pester on Nano.","pos":[5876,6144]},{"content":"You can review the changes in versions 3.3.5 to 3.4.0 by inspecting the ChangeLog.md file at: https://github.com/pester/Pester/blob/master/CHANGELOG.md","pos":[6147,6298]}],"content":"---\ntitle:   New Scenarios and Features in WMF 5.1 (Preview)\nms.date:  2016-07-13\nkeywords:  PowerShell, DSC, WMF\ndescription:  \nms.topic:  article\nauthor:  keithb\nmanager:  dongill\nms.prod:  powershell\nms.technology: WMF\n---\n\n# New Scenarios and Features in WMF 5.1 (Preview) #\n\n> Note: This information is preliminary and subject to change.\n\n## PowerShell Editions ##\nStarting with version 5.1, PowerShell is available in different editions which denote varying feature sets and platform compatibility.\n\n- **Desktop Edition:** Built on .NET Framework and provides compatibility with scripts and modules targeting versions of PowerShell running on full footprint editions of Windows such as Server Core and Windows Desktop.\n- **Core Edition:** Built on .NET Core and provides compatibility with scripts and modules targeting versions of PowerShell running on reduced footprint editions of Windows such as Nano Server and Windows IoT.\n\n**Learn more about using PowerShell Editions**\n- [Determine running edition of PowerShell]()\n- [Declare a module's compatibility to specific PowerShell versions]()\n- [Filter Get-Module results by CompatiblePSEditions]()\n- [Prevent script execution unless run on a comaptible edition of PowerShell]()\n\n## Catalog Cmdlets  \n\nTwo new cmdlets have been added in the [Microsoft.Powershell.Secuity](https://technet.microsoft.com/en-us/library/hh847877.aspx) module; these generate and validate windows catalog files.  \n\n###New-FileCatalog \n--------------------------------\n\nNew File catalog creates a Windows catalog file for set of folders and files. This catalog file contains hashes for all files in specified paths. Users can distribute the set of folders along with corresponding catalog file representing those folders. This information is useful to validate whether any changes have been made to the folders since catalog creation time.    \n\n```PowerShell\nNew-FileCatalog [-CatalogFilePath] <string> [[-Path] <string[]>] [-CatalogVersion <int>] [-WhatIf] [-Confirm] [<CommonParameters>]\n```\nCatalog versions 1 and 2 are supported. Version 1 uses the SHA1 hashing algorithm to create file hashes; version 2 uses SHA256. Catalog version 2 is not supported on *Windows Server 2008 R2* or *Windows 7*. You should use catalog version 2 on *Windows 8*, *Windows Server 2012*, and later operating systems.  \n\n![](../images/NewFileCatalog.jpg)\n\nThis creates the catalog file. \n\n![](../images/CatalogFile1.jpg)  \n\n![](../images/CatalogFile2.jpg) \n\nTo verify the integrity of catalog file (Pester.cat in above exmaple), sign it using [Set-AuthenticodeSignature](https://technet.microsoft.com/library/hh849819.aspx) cmdlet.   \n\n\n###Test-FileCatalog \n--------------------------------\n\nTest File catalog validates the catalog representing a set of folders. \n\n```PowerShell\nTest-FileCatalog [-CatalogFilePath] <string> [[-Path] <string[]>] [-Detailed] [-FilesToSkip <string[]>] [-WhatIf] [-Confirm] [<CommonParameters>]\n```\n\n![](../images/TestFileCatalog.jpg)\n\nThis cmdlet compares all the files hashes and their relative paths found in *catalog* with ones on *disk*. If it detects any mismatch between file hashes and paths it returns the status as *ValidationFailed*. Users can retrieve all this information by using the *-Detailed* flag. It also displays signing status of catalog in *Signature* filed which is equivalent to calling [Get-AuthenticodeSignature](https://technet.microsoft.com/en-us/library/hh849805.aspx) cmdlet on the catalog file. \nUsers can also skip any file during validation by using the *-FilesToSkip* parameter. \n\n\n## Module Analysis Cache ##\nStarting with WMF 5.1, PowerShell provides control\nover the file that is used to cache data about a module, such as the commands it exports.\n\nBy default, this cache is stored in the file `${env:LOCALAPPDATA}\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`.\nThe cache is typically read at startup while searching for a command\nand is written on a background thread sometime after a module is imported.\n\nTo change the default location of the cache, set the environment variable PSModuleAnalysisCachePath\nbefore starting PowerShell. Changes to this environment variable will only affect children processes.\nThe value should name a full path (including filename) that PowerShell has permission to create and write files.\nTo disable the file cache, set this value to an invalid location, for example:\n\n```PowerShell\n$env:PSModuleAnalysisCachePath = 'nul'\n```\n\nThis sets the path to an invalid device. Iff PowerShell can't write to the path, no error is returned, but you can see error reporting via a tracer:\n\n```PowerShell\nTrace-Command -PSHost -Name Modules -Expression { Import-Module Microsoft.PowerShell.Management -Force }\n```\n\nWhen writing out the cache, PowerShell will check for modules that no longer exist\nto avoid an unnecessarily large cache.\nSometimes these checks are not desirable, in which case you can turn them off by setting\n\n```PowerShell\n$env:PSDisableModuleAnalysisCacheCleanup = 1\n```\n\nSetting this environment variable will take effect immediately in the current process.\n\n##Specifying module version\n\nIn WMF 5.1, `using module` behaves the same way as other module-related constructions in PowerShell. Previously, you had no way to specify a particular module version; if there were multiple versions present, this resulted in an error.\n\n\nIn WMF 5.1:\n\n* You can use `ModuleSpecification` [hashtable](https://msdn.microsoft.com/en-us/library/jj136290(v=vs.85).aspx). \nThis hashtable has the same format as `Get-Module -FullyQualifiedName`.\n\n**Example:** `using module @{ModuleName = 'PSReadLine'; RequiredVersion = '1.1'}`\n\n* If there are multiple versions of the module, PowerShell uses the **same resolution logic** as `Import-Module` and doesn't return an error--the same behavior as `Import-Module` and `Import-DscResource`.\n\n\n\n\n\n\n\n\n##Improvements to Pester\nIn WMF 5.1, the version of Pester that ships with PowerShell has been updated from 3.3.5 to 3.4.0, with the addition of commit https://github.com/pester/Pester/pull/484/commits/3854ae8a1f215b39697ac6c2607baf42257b102e, which enables better behavior for Pester on Nano. \n\nYou can review the changes in versions 3.3.5 to 3.4.0 by inspecting the ChangeLog.md file at: https://github.com/pester/Pester/blob/master/CHANGELOG.md\n"}